# Base docker composition. For development, this composition is augmented in docker-compose.override.yml.

version: '3'
services:
  www:
    image: ictu/quality-time_proxy:${QUALITY_TIME_VERSION}
    ports:
      - "${PROXY_PORT:-80}:80"
    environment:
      - FRONTEND_HOST=${FRONTEND_HOST:-frontend}
      - FRONTEND_PORT=${FRONTEND_PORT:-5000}
      - API_SERVER_HOST=${API_SERVER_HOST:-api_server}
      - API_SERVER_PORT=${API_SERVER_PORT:-5001}
    volumes:
      - "/etc/localtime:/etc/localtime:ro"
    depends_on:
      - api_server
      - frontend
  frontend:
    image: ictu/quality-time_frontend:${QUALITY_TIME_VERSION}
    environment:
      - FRONTEND_PORT=${FRONTEND_PORT:-5000}
    volumes:
      - "/etc/localtime:/etc/localtime:ro"
    depends_on:
      - api_server
    cap_drop:
      - ALL
  collector:
    image: ictu/quality-time_collector:${QUALITY_TIME_VERSION}
    env_file:
      - ../components/collector/default.env
    volumes:
      - "/etc/localtime:/etc/localtime:ro"
    depends_on:
      - database
    cap_drop:
      - ALL
  notifier:
    image: ictu/quality-time_notifier:${QUALITY_TIME_VERSION}
    env_file:
      - ../components/notifier/default.env
    volumes:
      - "/etc/localtime:/etc/localtime:ro"
    depends_on:
      - database
    cap_drop:
      - ALL
  api_server:
    image: ictu/quality-time_api_server:${QUALITY_TIME_VERSION}
    env_file:
      - ../components/api_server/default.env
    volumes:
      - "/etc/localtime:/etc/localtime:ro"
    depends_on:
      - database
    cap_drop:
      - ALL
  database:
    image: ictu/quality-time_database:${QUALITY_TIME_VERSION}
    command: --quiet
    restart: always
    environment:
      - MONGO_INITDB_ROOT_USERNAME=${MONGO_INITDB_ROOT_USERNAME:-root}
      - MONGO_INITDB_ROOT_PASSWORD=${MONGO_INITDB_ROOT_PASSWORD:-root}
    volumes:
      - "/etc/localtime:/etc/localtime:ro"
      - "dbdata:/data/db"
  renderer:
    image: ictu/quality-time_renderer:${QUALITY_TIME_VERSION}
    environment:
      - PROXY_HOST=${PROXY_HOST:-www}
      - PROXY_PORT=${PROXY_PORT:-80}
      - LC_ALL=${LC_ALL:-en_GB.UTF-8}  # Set the date format in the PDF export to DD-MM-YYYY
      - TZ=${TZ:-Europe/Amsterdam}  # Make the PDF export use the correct timezone
    volumes:
      - "/etc/localtime:/etc/localtime:ro"
volumes:
  dbdata:
